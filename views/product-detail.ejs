<%- include('partials/header.ejs'); -%>
    <style>
        .quantity-selector {
            display: flex;
            align-items: center;
            /* border: 1px solid #ddd; */
            margin-bottom: 10px;
            border-radius: 5px;
            overflow: hidden;
        }

        .quantity {
            width: 50px;
            text-align: center;
            font-size: 16px;
            padding: 5px;
            border: none;
            outline: none;
        }

        .quantity-btn {
            background-color: #f0f0f0;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 16px;
        }

        .quantity-btn:hover {
            background-color: #ddd;
        }

        .quantity::-webkit-outer-spin-button,
        .quantity::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>

    <style>
        .reviews-container {
            margin-top: 30px;
            margin: 0 200px;
            padding: 20px;
            border-top: 2px solid #ddd;
        }

        .review-title {
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .review-list {
            margin-bottom: 20px;
        }

        .review-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }

        .review-user {
            font-weight: bold;
            color: #007bff;
        }

        .review-rating {
            color: #ffcc00;
        }

        .review-comment {
            margin: 5px 0;
        }

        .review-date {
            font-size: 12px;
            color: gray;
        }

        .review-form {
            margin-top: 20px;
            padding: 35px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .review-rating-input,
        .review-comment-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .submit-review {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
        }

        .submit-review:hover {
            background-color: #218838;
        }
    </style>
    <main class="product-detail">
        <div class="container">
            <!-- C·ªôt tr√°i: ·∫¢nh s·∫£n ph·∫©m -->
            <div class="product-images">
                <img id="main-image" src="<%= images.length ? images[0].image_url : 'no-image.jpg' %>"
                    alt="·∫¢nh s·∫£n ph·∫©m">
                <div class="thumbnail-list">
                    <% images.slice(0,5).forEach(img=> { %>
                        <img class="thumbnail" src="<%= img.image_url %>" alt="·∫¢nh nh·ªè"
                            onclick="changeImage('<%= img.image_url %>')">
                        <% }); %>
                </div>
            </div>
            <!-- C·ªôt ph·∫£i: Th√¥ng tin s·∫£n ph·∫©m -->
            <div class="product-info">
                <h1>
                    <%= product.name %>
                </h1>
                <p class="price">Gi√°: <strong>
                        <%= Number(product.price).toLocaleString("vi-VN") %> VNƒê
                    </strong></p>
                <p><strong>M√¥ t·∫£:</strong>
                    <%= product.description %>
                </p>
                <p><strong>Th√¥ng s·ªë k·ªπ thu·∫≠t:</strong>
                    <%= details.specifications || "Kh√¥ng c√≥ th√¥ng tin" %>
                </p>
                <p><strong>B·∫£o h√†nh:</strong>
                    <%= details.warranty || "Kh√¥ng c√≥ th√¥ng tin" %>
                </p>
                <p><strong>Chi ti·∫øt b·ªï sung:</strong>
                    <%= details.additional_info || "Kh√¥ng c√≥ th√¥ng tin" %>
                </p>

                <!-- N√∫t mua h√†ng -->
                <form action="/cart" method="POST">
                    <input type="hidden" name="product_id" value="<%= product.id %>">
                    <div class="buttons">
                        <div class="quantity-selector">
                            <button type="button" class="btn decrease quantity-btn">‚ûñ</button>
                            <input type="number" name="quantity" class="quantity" value="1" min="1">
                            <button type="button" class="btn increase quantity-btn">‚ûï</button>
                        </div>

                        <button type="submit" name="action" value="add-to-cart" class="btn add-to-cart">üõí Th√™m v√†o gi·ªè
                            h√†ng</button>
                        <button type="submit" name="action" value="buy-now" class="btn buy-now">‚ö° Mua ngay</button>
                    </div>
                </form>


                <a onclick="history.back()" class="back-link" href="/">‚Üê Quay l·∫°i</a>
            </div>
            <!-- Th√¥ng b√°o -->
            <!-- Th√¥ng b√°o gi·ªè h√†ng -->
            <!-- <div id="cart-notification" class="cart-notification">S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè h√†ng!</div> -->
        </div>
        <div class="reviews-container">
            <p id="error-message" style="color: red; font-size: 20px;"><%= errorMessageProduct %></p>
            <h2 class="review-title">ƒê√°nh gi√° s·∫£n ph·∫©m</h2>

            <!-- Hi·ªÉn th·ªã danh s√°ch ƒë√°nh gi√° -->
            <div class="review-list">
                <% if (reviews.length> 0) { %>
                    <% reviews.forEach(review=> { %>
                        <div class="review-item">
                            <strong class="review-user">
                                <%= review.display_name %>
                            </strong>
                            - <span class="review-rating">
                                <%= '‚≠ê' .repeat(review.rating) %>
                            </span>
                            <p class="review-comment">
                                <%= review.comment %>
                            </p>
                            <small class="review-date">
                                <%= new Date(review.created_at).toLocaleString() %>
                            </small>
                        </div>
                        <% }) %>
                            <% } else { %>
                                <p class="no-reviews">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o.</p>
                                <% } %>
            </div>

            <!-- Form th√™m ƒë√°nh gi√° -->
            <form id="review-form" class="review-form" action="/reviews" method="POST">
                <input type="hidden" name="product_id" value="<%= product.id %>">
                <!-- <input type="hidden" name="user_id" value=""> -->
                <label for="rating">Ch·ªçn ƒë√°nh gi√°:</label>
                <select name="rating" class="review-rating-input" required>
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê - Tuy·ªát v·ªùi</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê - T·ªët</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê - B√¨nh th∆∞·ªùng</option>
                    <option value="2">‚≠ê‚≠ê - Kh√¥ng h√†i l√≤ng</option>
                    <option value="1">‚≠ê - T·ªá</option>
                </select>

                <textarea name="comment" class="review-comment-input" placeholder="Vi·∫øt ƒë√°nh gi√° c·ªßa b·∫°n..."
                    required></textarea>
                <button type="submit" class="btn submit-review">G·ª≠i ƒë√°nh gi√°</button>
            </form>
        </div>

    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const decreaseBtn = document.querySelector(".decrease");
            const increaseBtn = document.querySelector(".increase");
            const quantityInput = document.querySelector(".quantity");

            decreaseBtn.addEventListener("click", () => {
                let value = parseInt(quantityInput.value);
                if (value > 1) {
                    quantityInput.value = value - 1;
                }
            });

            increaseBtn.addEventListener("click", () => {
                let value = parseInt(quantityInput.value);
                quantityInput.value = value + 1;
            });
        });


        function changeImage(imageUrl) {
            document.getElementById('main-image').src = imageUrl;
        }
    </script>
    <style>
        .cart-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(40, 167, 69, 0.9);
            /* M√†u xanh th√†nh c√¥ng */
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            display: none;
            /* ·∫®n ban ƒë·∫ßu */
            z-index: 1000;
            /* ƒê·∫£m b·∫£o hi·ªÉn th·ªã tr√™n c√°c ph·∫ßn kh√°c */
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            transition: opacity 0.5s ease-in-out, transform 0.3s ease-in-out;
        }

        .cart-notification.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .cart-notification.hide {
            opacity: 0;
            transform: translateY(-20px);
        }
    </style>
    <%- include('partials/footer.ejs'); -%>